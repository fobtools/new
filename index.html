document.addEventListener('DOMContentLoaded', () => {
    const addBtn = document.querySelector('.add-btn');
    const modal = document.getElementById('add-modal');
    const closeModalBtn = document.querySelector('.close-btn');
    const saveBtn = document.getElementById('save-btn');
    const cardsContainer = document.getElementById('cards-container');

    // 从 localStorage 获取已有的收藏数据
    let bookmarks = JSON.parse(localStorage.getItem('bookmarks')) || [];

    // 渲染收藏卡片
    function renderBookmarks() {
        // 清空当前容器
        cardsContainer.innerHTML = '';

        // 遍历收藏数据并生成卡片
        bookmarks.forEach((bookmark, index) => {
            const card = document.createElement('div');
            card.classList.add('card');
            card.innerHTML = `
                <div class="card-content">
                    <h3>${bookmark.name}</h3>
                    <p><a href="${bookmark.url}" target="_blank">${bookmark.url}</a></p>
                    <p>添加时间: ${bookmark.date}</p>
                </div>
                <div class="card-actions">
                    <i class="fas fa-trash" data-index="${index}"></i>
                </div>
            `;

            // 绑定删除事件
            const deleteBtn = card.querySelector('.fa-trash');
            deleteBtn.addEventListener('click', () => {
                deleteBookmark(index);
            });

            cardsContainer.appendChild(card);
        });
    }

    // 打开弹窗
    addBtn.addEventListener('click', () => {
        modal.style.display = 'block';
    });

    // 关闭弹窗
    closeModalBtn.addEventListener('click', () => {
        modal.style.display = 'none';
    });

    // 保存收藏
    saveBtn.addEventListener('click', () => {
        const siteName = document.getElementById('site-name').value;
        const siteUrl = document.getElementById('site-url').value;

        if (siteName === '' || siteUrl === '') {
            alert('请填写完整信息');
            return;
        }

        // 构建新收藏对象
        const bookmark = {
            name: siteName,
            url: siteUrl,
            date: new Date().toLocaleString(),
            frequency: 0
        };

        // 添加到收藏列表并保存到 localStorage
        bookmarks.push(bookmark);
        localStorage.setItem('bookmarks', JSON.stringify(bookmarks));

        // 重新渲染收藏卡片并关闭弹窗
        renderBookmarks();
        modal.style.display = 'none';

        // 清空输入框
        document.getElementById('site-name').value = '';
        document.getElementById('site-url').value = '';
    });

    // 删除收藏
    function deleteBookmark(index) {
        bookmarks.splice(index, 1);
        localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
        renderBookmarks();
    }

    // 初始加载时渲染收藏
    renderBookmarks();
});
